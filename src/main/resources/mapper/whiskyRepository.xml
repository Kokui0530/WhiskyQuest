<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whisukiquest.whiskyquest_api.repository.WhiskyRepository">


  <!--User情報検索-->
  <select id="searchUserById" resultType="com.whisukiquest.whiskyquest_api.data.Users">
    SELECT * FROM users WHERE id= #{id} AND is_deleted = FALSE
  </select>

  <!--Whisky情報全件検索-->
  <select id="searchWhisky" resultType="com.whisukiquest.whiskyquest_api.data.Whisky">
    SELECT * FROM whisky WHERE is_deleted = FALSE
  </select>

  <!--Whisky情報検索-->
  <select id="searchWhiskyList" resultType="com.whisukiquest.whiskyquest_api.data.Whisky">
    SELECT * FROM whisky WHERE user_id= #{userId} AND is_deleted = FALSE
  </select>

  <!--Whisky詳細検索、whiskyIdで検索-->
  <select id="searchWhiskyById" resultType="com.whisukiquest.whiskyquest_api.data.Whisky">
    SELECT * FROM whisky WHERE id= #{id} AND is_deleted = FALSE
  </select>

  <!--Whisky詳細検索、whiskyNameで検索-->
  <select id="searchWhiskyByName" resultType="com.whisukiquest.whiskyquest_api.data.Whisky">
    SELECT * FROM whisky WHERE name= #{name} AND is_deleted = FALSE
  </select>

  <!--Rating情報平均検索-->
  <select id="searchAverageRating" resultType="com.whisukiquest.whiskyquest_api.domain.RatingAverage">
    SELECT whisky_id, AVG(rating) AS average_rating, COUNT(*) AS rating_count
    FROM rating GROUP BY whisky_id
  </select>

  <!--Rating情報検索-->
  <select id="searchRatingList" resultType="com.whisukiquest.whiskyquest_api.data.Rating">
    SELECT * FROM rating WHERE user_id= #{userId} AND is_deleted = FALSE
  </select>

  <!--Rating一覧検索、whiskyIdで検索-->
  <select id="searchRatingByWhiskyId" resultType="com.whisukiquest.whiskyquest_api.data.Rating">
    SELECT * FROM rating WHERE whisky_id= #{whiskyId} AND is_deleted = FALSE
  </select>

  <!--Rating１件の検索　ratingIdで検索-->
  <select id="searchRatingById" resultType="com.whisukiquest.whiskyquest_api.data.Rating">
    SELECT * FROM rating WHERE id = #{ratingId} AND is_deleted = FALSE
  </select>

  <!--ユーザー情報の新規登録-->
  <insert id="registerUser" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO users(user_name,mail,password)
    VALUES(#{userName} , #{mail} , #{password})
  </insert>

  <!--ウイスキー情報の新規登録-->
  <insert id="registerWhisky" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO whisky(user_id , name , taste , drinking_style , price , is_deleted)
    VALUES(#{userId} , #{name} , #{taste} , #{drinkingStyle} , #{price} , false)
  </insert>

  <!--評価情報の新規登録-->
  <insert id="registerRating" useGeneratedKeys="true" keyProperty="id">
    INSERT INTO rating(user_id , whisky_id , rating , comment)
    VALUES(#{userId} , #{whiskyId} , #{rating} , #{comment})
  </insert>

  <!--ユーザー情報の更新-->
  <update id="updateUser">
    UPDATE users SET user_name = #{userName} , mail = #{mail} , password = #{password}
    WHERE id = #{id}
  </update>

  <!--ウイスキー情報の更新-->
  <update id="updateWhisky">
    UPDATE whisky SET user_id = #{userId} , name = #{name} , taste = #{taste} ,
    drinking_style = #{drinkingStyle} , price = #{price} , is_deleted = #{isDeleted}
    WHERE id = #{id}
  </update>

  <!--評価情報の更新-->
  <update id="updateRating">
    UPDATE rating SET user_id = #{userId} , whisky_id = #{whiskyId} , rating = #{rating} ,comment = #{comment}
    WHERE id = #{id}
  </update>

  <!--ユーザー情報の論理削除-->
  <update id="deleteUser">
    UPDATE users SET is_deleted = TRUE WHERE id = #{id}
  </update>

  <!--ウイスキー情報の論理削除-->
  <update id="deleteWhisky">
    UPDATE whisky SET is_deleted = TRUE WHERE user_id = #{userId} AND id = #{id}
  </update>

  <!--評価情報の論理削除-->
  <update id="deleteRating">
    UPDATE rating SET is_deleted = TRUE WHERE user_id = #{userId} AND id = #{id}
  </update>


</mapper>

